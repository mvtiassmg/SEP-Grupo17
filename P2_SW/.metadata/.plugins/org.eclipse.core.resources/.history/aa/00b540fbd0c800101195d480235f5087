#include "TempSensor.h"
#include "LCD_GUI.h" // Para los colores RED, BLUE, YELLOW, CYAN

// Declaración externa coincidente con tu i2c.h
extern int read_tmp();

// Umbrales en grados Celsius (Enteros)
// Ajusta estos valores si sientes que cambia muy rápido o muy lento
#define TEMP_COLD_THRESH 24
#define TEMP_HOT_THRESH  28

void TempSensor_init(TempSensor *ts)
{
    ts->current_temp = 25; // Valor inicial seguro
    ts->player_color = YELLOW;
}

void TempSensor_update(TempSensor *ts)
{
    // Leemos directamente el entero desde tu driver I2C
    ts->current_temp = read_tmp();

    // Lógica de color basada en la temperatura leída
    if (ts->current_temp < TEMP_COLD_THRESH) {
        ts->player_color = CYAN; // Frío
    }
    else if (ts->current_temp > TEMP_HOT_THRESH) {
        ts->player_color = RED;  // Caliente
    }
    else {
        ts->player_color = YELLOW; // Normal/Tibio
    }
}
