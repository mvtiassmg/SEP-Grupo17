#include "LightSensor.h"

// Esta función debe existir en tu I2C.c (o donde la hayas puesto para el test)
extern int read_opt();

void LightSensor_init(LightSensor *ls)
{
    ls->lux_value = 0;
    ls->mode = LIGHT_MODE_DAY;
    // Ajusta estos umbrales según tus pruebas con la linterna/mano
    ls->threshold_day   = 300;  
    ls->threshold_night = 100;
}

void LightSensor_update(LightSensor *ls)
{
    ls->lux_value = read_opt();

    // Histéresis simple para evitar parpadeo en el borde
    if (ls->mode == LIGHT_MODE_NIGHT) {
        if (ls->lux_value > ls->threshold_day)
            ls->mode = LIGHT_MODE_DAY;
    } else {
        if (ls->lux_value < ls->threshold_night)
            ls->mode = LIGHT_MODE_NIGHT;
    }
}
