#include "TempSensor.h"
#include "LCD_GUI.h"

// Función externa definida en i2c.c
extern int read_tmp();

// Umbrales en grados Celsius (Enteros)
// Temp ambiente normal ~28-30°C (el chip se calienta un poco)
// Tocar con el dedo ~32-34°C
#define TEMP_COLD_THRESH 27 // Menos de 27°C -> Frío (Azul)
#define TEMP_HOT_THRESH  31 // Más de 31°C -> Caliente (Rojo)

void TempSensor_init(TempSensor *ts)
{
    ts->current_temp = 25;
    ts->player_color = YELLOW; // Color neutro inicial
}

void TempSensor_update(TempSensor *ts)
{
    // Leer temperatura en grados Celsius desde el driver I2C
    ts->current_temp = read_tmp();

    // Lógica de color
    if (ts->current_temp < TEMP_COLD_THRESH) {
        ts->player_color = CYAN; // Frío
    }
    else if (ts->current_temp > TEMP_HOT_THRESH) {
        ts->player_color = RED;  // Caliente (Tocar sensor)
    }
    else {
        ts->player_color = YELLOW; // Normal
    }
}
